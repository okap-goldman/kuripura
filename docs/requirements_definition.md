# 1. サービス概要

- サービス名（仮）：目醒め人のためのSNS
- コンセプト：本当に深い繋がりを重視し、「目醒め」をテーマにした、共感・学び合い・自己表現ができるコミュニティSNS
- 対象ユーザー：
  - 「目醒め」というテーマに興味・関心がある方
  - 深いコミュニケーションや自己探求・自己表現を望む方
- 提供プラットフォーム：
  - スマートフォンアプリ（iOS / Android, React Native v7.6 + Expo）

# 2. 全体構成・基本機能

## 2.1 ユーザー管理機能

### 1. アカウント作成 / ログイン
- Googleアカウント連携のみでユーザー登録・ログインを行う
- パスワード入力やローカル管理は不要
- 利用規約・プライバシーポリシーへの同意

### 2. アカウント設定
- 表示名、プロフィール文（ライトワークの説明）
- プロフィール画像登録
- 自己紹介音声登録
- ショップ用URL、または外部リンクURLの設定
- 通知設定：通知対象は「コメント」「ハイライト」「新規フォロワー」の3種類

## 2.2 フォロー機能
- フォローには「ファミリー」と「ウォッチ」の2種類がある

### 1. ファミリー
- フォロー時：
  - 理由入力が必須
  - 入力した理由は相手にも通知される
- アンフォロー時：
  - 理由入力は必須だが通知はされない（システムのみ保持）
- 誰をファミリーにしているか（ファミリーリスト）は他のユーザーからも閲覧可能

### 2. ウォッチ
- 特に理由入力は不要
- 誰がウォッチしているかは、通常のフォローリストとして公開

# 3. タイムライン（メインフィード）機能

## 3.1 投稿

### 3.1.1 投稿できるメディア

#### 1. 動画
- スマホアプリ内で撮影可能 + 端末に保存済み動画もアップロード可
- YouTube APIでユーザーのYouTubeアカウントにアップロード
- 公開 or 限定公開 を選択可能
- YouTubeと同等のファイル形式・サイズを許容

#### 2. 画像
- スマホ内の画像をアップロード
- GIFもアップロード可能
- アップロードされた画像はBoxに保存し、キャッシュサーバーを介して配信

#### 3. 音声
- スマホアプリ内で録音機能を提供 + 端末に保存済み音声のアップロード
- PodBean APIでユーザーのPodBeanアカウントにアップロード（限定公開で設定）
- PodBeanと同等のファイル形式・サイズを許容

#### 4. テキスト
- 最大10,000文字まで投稿可能
- タイムライン上は先頭280文字を表示、残りは「すべて表示」をタップして全文表示
- Markdownサポート（改行、強調表示、リンクなど）

### 3.1.2 タイムライン表示
- 動画・画像・音声・テキストが混在し、縦スクロール形式で表示
- デフォルト表示は「ファミリー」タイムライン
- ウォッチタイムラインは切り替えボタン＋確認モーダルで表示

### 3.1.3 アクション

#### 1. いいね（ハート）
- タップでハートが色付き、もう一度タップで取り消し可能

#### 2. コメント
- コメントボタン→入力欄が出現→送信するとコメントが投稿
- 投稿者への通知あり

#### 3. ハイライト（炎アイコン）
- 「何に心震えたか」の理由入力必須
- 一度ハイライトすると取り消し不可
- ハイライト理由は他のユーザー全員が閲覧可能
- ハイライトされた投稿の投稿者は通知を受け取る

# 4. プロフィール機能

## 4.1 レイアウト

### 1. 上部エリア
- 左：自己紹介音声再生ボタン
- 中央：プロフィール画像
- 右：ショップアイコン or 外部リンクアイコン

### 2. 自己紹介文
- 280文字まで
- ライトワーク（地球に来た目的）を記入

### 3. フォロワー数表示
- ファミリー数 / ウォッチ数 別で表示
- ファミリー一覧は公開

### 4. 投稿表示タブ
- メディア（画像・動画）：Instagram風タイル表示
  - 1行3タイルが基本
  - タイル結合（3タイル横長 / 4タイル正方形 / 9タイル大正方形）も可能
- 音声：PodBeanのような再生リストUI
- テキスト：X(旧Twitter)風のリスト表示、280文字プレビュー＋全文表示
- ハイライト：ユーザーがハイライトした他人の投稿一覧
- イベント：主催または参加しているイベント一覧

### 5. ショップ
- ショップアイコンをタップ→そのユーザーが出品している商品一覧を表示
- アプリ内で購入可能（決済はStripeを利用）
- 取引管理（購入履歴・販売履歴など）
- ヘッダーから取引管理画面に遷移可能

# 5. 検索・AIチャット機能

## 5.1 検索ページUI
- 画面中央に検索バーと質問サジェスト
- ユーザー・投稿検索 + 「目醒め」に関する質問
- 質問1日5回まで
- 質問→AIが「あなたはどう思いますか？」→ユーザーが回答→AIが回答
- キーワード入力後はチャットUIへ移行し、追加質問やSNS設定変更が可能

## 5.2 AI連携
- **大規模言語モデル「DeepSeek R1」**とのAPI連携を想定
- プロンプト設計とプライバシー保護を要検討

# 6. イベント機能

## 6.1 イベント登録（プレミアムユーザーのみ）
- 入力項目：イベント名、開催日時、場所（公開範囲選択可）、参加費、募集期間、コンテンツ概要、主催者・共同開催者
- 有料イベントの決済フロー：
  - 決済手数料は7%
  - 決済ボタン押下→Stripe Checkoutへ遷移→完了後、ユーザーのイベント管理ページに戻る
  - イベント管理ページで、参加者一覧や詳細を確認

## 6.2 イベント詳細ページ
- イベント登録情報 + 参加者数、興味アリ数（未参加だが気になっている人数）
- 関連投稿一覧（主催者が紐づけた投稿 など）

## 6.3 イベントと投稿の紐づけ
- 投稿時に主催・参加しているイベントを紐づけ可能
- イベント開始前は主催者のみ投稿できるようにする設定もあり

## 6.4 イベント一覧
- 「発見」ページやユーザープロフィールから閲覧
- 開催場所・参加費などでフィルタリング

# 7. 発見（Discovery）ページ

## 7.1 分析
- 自分の目醒め度/アクティビティ分析表示
- ワンポイントアドバイス（例：「不安を感じたら〜」等）
- 全体の目醒め傾向表示（匿名集計）

## 7.2 地域毎の活動状況
- 3Dマップで都道府県単位の盛り上がり度を色分け表示
- 都道府県をタップ→その地域のイベントや活動履歴を表示

## 7.3 イベント一覧
- 全ユーザーの企画イベントを一覧表示
- 開催場所・参加費などでフィルタリング
- プレミアムユーザーはここから新規イベント企画可

## 7.4 おすすめ投稿
- ユーザーのアクティビティを分析し、「そのユーザーの魂がワクワクする投稿」を推定
- 分析結果からSQLクエリを自動生成し、そのクエリ結果を表示
- 運営ピックアップイベントや特集投稿も表示枠を設置（将来的拡張）

# 8. 非機能要件

## 8.1 パフォーマンス・スケーラビリティ
- 想定MAU: 10,000人
- 1人あたりの投稿数: 0.3件/日
- 1人あたりのストーリーズ: 2件/日
- CDN、キャッシュサーバー等を活用し、画像/GIF/動画/音声の負荷を分散

## 8.2 セキュリティ
- Google連携のみのためパスワード管理は不要
- HTTPS通信必須
- 各外部ストレージ（YouTube, Box, PodBean）API連携時の認証管理
- CSRF / XSS対策
- 決済はStripeを利用 → カード情報はStripe側で管理

## 8.3 拡張性
- 今後の追加要件（広告配信、多言語対応など）を見据えた設計
- 運営によるピックアップイベントや特集投稿を発信できる仕組み

## 8.4 保守・運用
- ユーザーサポート体制（問い合わせフォーム、管理者画面）
- ログ取得・分析（アクセスログ、エラーログ）
- バックアップ（Supabaseデータ、外部ストレージ連携のメタ情報）

# 9. 管理者機能

1. ユーザー管理
   - ユーザー情報の検索・閲覧・停止/削除
2. 投稿管理
   - 違反報告された投稿・コメントのモデレーション
3. イベント管理
   - 不適切なイベント削除
   - プレミアムユーザー管理（サブスク未払いの場合の権限剥奪など）
4. ショップ管理
   - 商品や取引のモニタリング（違反報告対応）
5. AIチャットログ監視
   - 問題あるやりとりを検知した場合、警告や凍結処理

# 10. システム構成

## 10.1 フロントエンド
- React Native v7.6 + Expo でiOS / Android向けネイティブアプリを構築

## 10.2 バックエンド
- Nest.jsでサーバーサイド実装
- 認証はGoogle OAuth
- Stripe決済連携、YouTube API、PodBean API、Box APIなど外部連携

## 10.3 データベース
- Supabase(PostgreSQL)を利用
- ユーザー情報、投稿メタデータ（タイトル, テキスト, 外部ストレージURL など）、コメント、ファミリー/ウォッチ情報、イベント情報、取引管理などを保存
- ストレージ
  - 画像/GIF：Boxにアップロード → キャッシュサーバー経由で配信
  - 動画：YouTubeにアップロード（公開 or 限定公開）
  - 音声：PodBeanにアップロード（限定公開）
  - テキスト：Supabase DBに直接保存（最大10,000文字／投稿）

## 10.4 決済関連
- Stripeで商品購入やイベント参加費を決済
- ショップ商品販売、イベントチケット購入に手数料を上乗せ
- プレミアムユーザーの月額サブスクリプションもStripeを利用

## 10.5 AI関連
- DeepSeek R1とのAPI連携
- ユーザーからの質問・回答内容を送受信
- 1日5回の質問制限などのカウント管理

## 10.6 通知
- **Firebase Cloud Messaging（FCM）**でプッシュ通知
- 通知対象は「コメント」「ハイライト」「新規フォロワー」